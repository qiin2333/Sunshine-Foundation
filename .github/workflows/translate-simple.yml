name: Simple README Translation

on:
  push:
    branches:
      - master
    paths:
      - 'README.md'
  workflow_dispatch:

jobs:
  translate-simple:
    name: Simple README Translation
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install translation dependencies
        run: |
          pip install googletrans==4.0.0rc1
          pip install requests

      - name: Create translation script
        run: |
          cat > translate_simple.py << 'EOF'
          import os
          import re
          from googletrans import Translator

          def protect_project_names(text):
              """ä¿æŠ¤é¡¹ç›®åç§°ä¸è¢«ç¿»è¯‘"""
              # å®šä¹‰éœ€è¦ä¿æŠ¤çš„é¡¹ç›®åç§°
              protected_names = [
                  "Sunshine åŸºåœ°ç‰ˆ",
                  "Sunshine-Foundation",
                  "LizardByte/Sunshine",
                  "Moonlight",
                  "Moonlight-PC",
                  "Moonlight-Android",
                  "Moonlight-iOS",
                  "awesome-sunshine",
                  "å¨åŠ›åŠ å¼ºç‰ˆ",
                  "çŽ‹å† ç‰ˆ",
                  "çœŸç –å®¶ç‰ˆ",
                  "qiin2333",
                  "WACrown",
                  "TrueZhuangJia",
                  "obs-amd",
                  "VAAPI",
                  "NVENC",
                  "AMD",
                  "Intel",
                  "Nvidia",
                  "Ryzen",
                  "Core i3",
                  "Core i5",
                  "GeForce GTX 1080",
                  "HD Graphics 510",
                  "Video Coding Engine",
                  "VCE",
                  "802.11ac",
                  "CAT5e",
                  "HDR",
                  "GameStream"
              ]
              
              # åˆ›å»ºå ä½ç¬¦æ˜ å°„
              placeholders = {}
              protected_text = text
              
              for i, name in enumerate(protected_names):
                  if name in protected_text:
                      placeholder = f"__PROTECTED_NAME_{i}__"
                      placeholders[placeholder] = name
                      protected_text = protected_text.replace(name, placeholder)
              
              return protected_text, placeholders

          def restore_project_names(text, placeholders):
              """æ¢å¤é¡¹ç›®åç§°"""
              restored_text = text
              for placeholder, name in placeholders.items():
                  restored_text = restored_text.replace(placeholder, name)
              return restored_text

          def translate_readme():
              # Read the original README
              with open('README.md', 'r', encoding='utf-8') as f:
                  content = f.read()
              
              # Initialize translator
              translator = Translator()
              
              # Languages to translate to
              languages = [
                  ('en', 'English'),
                  ('zh-CN', 'Chinese Simplified'),
                  ('fr', 'French'),
                  ('de', 'German'),
                  ('ja', 'Japanese')
              ]
              
              for lang_code, lang_name in languages:
                  try:
                      if lang_code == 'en':
                          # For English, copy the original content
                          translated_content = content
                      else:
                          # Protect project names before translation
                          protected_content, placeholders = protect_project_names(content)
                          
                          # Translate the protected content
                          translated = translator.translate(protected_content, dest=lang_code)
                          translated_text = translated.text
                          
                          # Restore project names after translation
                          translated_content = restore_project_names(translated_text, placeholders)
                      
                      # Write translated file
                      filename = f'README.{lang_code}.md'
                      with open(filename, 'w', encoding='utf-8') as f:
                          f.write(translated_content)
                      
                      print(f"âœ“ Translated to {lang_name} ({lang_code}) with project names protected")
                      
                  except Exception as e:
                      print(f"âœ— Failed to translate to {lang_name}: {e}")

          if __name__ == "__main__":
              translate_readme()
          EOF

      - name: Run translation
        run: python translate_simple.py

      - name: Add language selector to README
        run: |
          # Check if language selector already exists
          if grep -q "å¤šè¯­è¨€æ”¯æŒ" README.md; then
            echo "Language selector already exists, skipping..."
          else
            # Create a backup of the original README
            cp README.md README.md.backup
            
            # Create the language selector content
            cat > language_selector.md << 'EOF'
          
          ## ðŸŒ å¤šè¯­è¨€æ”¯æŒ / Multi-language Support

          <div align="center">

          [![English](https://img.shields.io/badge/English-README.en.md-blue?style=for-the-badge)](README.en.md)
          [![ä¸­æ–‡ç®€ä½“](https://img.shields.io/badge/ä¸­æ–‡ç®€ä½“-README.zh--CN.md-red?style=for-the-badge)](README.zh-CN.md)
          [![FranÃ§ais](https://img.shields.io/badge/FranÃ§ais-README.fr.md-green?style=for-the-badge)](README.fr.md)
          [![Deutsch](https://img.shields.io/badge/Deutsch-README.de.md-yellow?style=for-the-badge)](README.de.md)
          [![æ—¥æœ¬èªž](https://img.shields.io/badge/æ—¥æœ¬èªž-README.ja.md-purple?style=for-the-badge)](README.ja.md)

          </div>

          ---

          EOF
            
            # Insert language selector after the first line (title)
            head -n 1 README.md > README.md.new
            cat language_selector.md >> README.md.new
            tail -n +2 README.md >> README.md.new
            
            # Replace the original file
            mv README.md.new README.md
            
            # Clean up
            rm language_selector.md
            
            echo "âœ“ Added language selector to main README"
          fi

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          title: "docs: add multi-language README translations with enhanced project name protection"
          body: |
            ## è‡ªåŠ¨ç¿»è¯‘æ›´æ–°
            
            æ­¤PRåŒ…å«ä»¥ä¸‹è¯­è¨€çš„READMEç¿»è¯‘ï¼š
            
            - English (en)
            - Chinese Simplified (zh-CN)
            - French (fr)
            - German (de)
            - Japanese (ja)
            
            ### ç¿»è¯‘è¯´æ˜Ž
            - ä½¿ç”¨Google Translate APIè‡ªåŠ¨ç¿»è¯‘
            - ä¿æŒåŽŸå§‹Markdownæ ¼å¼
            - ä¿ç•™æ‰€æœ‰é“¾æŽ¥å’Œå›¾ç‰‡
            - **é¡¹ç›®åç§°ä¿æŠ¤**: ç¡®ä¿é¡¹ç›®åç§°ä¸è¢«ç¿»è¯‘
            - å»ºè®®äººå·¥æ£€æŸ¥ç¿»è¯‘è´¨é‡
            
            ### å—ä¿æŠ¤çš„é¡¹ç›®åç§°å’Œæœ¯è¯­
            - Sunshine åŸºåœ°ç‰ˆ
            - Sunshine-Foundation
            - LizardByte/Sunshine
            - Moonlight (å„ç§ç‰ˆæœ¬)
            - å¨åŠ›åŠ å¼ºç‰ˆã€çŽ‹å† ç‰ˆã€çœŸç –å®¶ç‰ˆ
            - å¼€å‘è€…ç”¨æˆ·å (qiin2333, WACrown, TrueZhuangJia)
            - æŠ€æœ¯æœ¯è¯­ (VAAPI, NVENC, HDR, GameStream)
            - ç¡¬ä»¶å“ç‰Œ (AMD, Intel, Nvidia, Ryzen, GeForce)
            - ç½‘ç»œæ ‡å‡† (802.11ac, CAT5e)
            
            ### ç”Ÿæˆçš„æ–‡ä»¶
            - `README.en.md` - è‹±è¯­ç‰ˆæœ¬
            - `README.zh-CN.md` - ç®€ä½“ä¸­æ–‡ç‰ˆæœ¬
            - `README.fr.md` - æ³•è¯­ç‰ˆæœ¬
            - `README.de.md` - å¾·è¯­ç‰ˆæœ¬
            - `README.ja.md` - æ—¥è¯­ç‰ˆæœ¬
            
            ### æ–°å¢žåŠŸèƒ½
            - åœ¨ä¸»READMEæ–‡ä»¶ä¸­æ·»åŠ äº†è¯­è¨€é€‰æ‹©å™¨
            - ç”¨æˆ·å¯ä»¥é€šè¿‡å¾½ç« å¿«é€Ÿè®¿é—®ä¸åŒè¯­è¨€ç‰ˆæœ¬
            - æ”¯æŒ5ç§è¯­è¨€çš„å¿«é€Ÿåˆ‡æ¢
            - é¡¹ç›®åç§°ä¿æŠ¤åŠŸèƒ½ï¼Œç¡®ä¿å“ç‰Œä¸€è‡´æ€§
            
            ---
            
            *æ­¤PRç”±CIè‡ªåŠ¨ç”Ÿæˆï¼Œå½“README.mdæ–‡ä»¶æ›´æ–°æ—¶è§¦å‘*
          branch: docs/translations
          delete-branch: true
          commit-message: "docs: add multi-language README translations [skip ci]"

      - name: Create summary
        run: |
          echo "## Translation Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "The following README translations were generated:" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          for file in README.*.md; do
            if [ -f "$file" ]; then
              lang=$(echo $file | sed 's/README\.\(.*\)\.md/\1/')
              echo "- $lang" >> $GITHUB_STEP_SUMMARY
            fi
          done
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "âœ“ Language selector added to main README" >> $GITHUB_STEP_SUMMARY
          echo "âœ“ Enhanced project name protection applied" >> $GITHUB_STEP_SUMMARY 